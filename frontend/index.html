<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>新冠肺炎实时疫情</title>
	<link rel="stylesheet" type="text/css" href="static/css/main.css" />
	<link rel="stylesheet" type="text/css" href="static/css/index.css" />
	<script type="text/javascript" src="static/js/index.js"></script>
	<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat/dist/ecStat.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/dataTool.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>


</head>
<body>
	<div id="header">
			<h1 style="display:inline;margin:5px 10px">新冠肺炎疫情情况</h1>
			<input type="date" id="nowDateTime"/>
			<div id="pageJump">
				<p id="pageJumpFont" style="margin:36px 10px 5px 159px"><a href="news.html">最新资讯</a></p>
				<img src="static/img/moveIcon.png"  style="margin:20px 0px -13px 0px"/>
			</div>
	</div>
	
	<div id="wrap">
		<div id="content">
		
			<div class="escMesage">
				<ul class="showEsc">
					<li class="esc">当前确诊</li>
					<li id="ip">0</li>
					<li id="addIp">0</li>
				</ul>
				<ul class="showEsc">
					<li class="esc">累计确诊</li>
					<li id="sumIp">0</li>
					<li id="addSumIp">0</li>
				</ul>
				<ul class="showEsc">
					<li class="esc">现有疑似</li>
					<li id="sp">0</li>
					<li id="addSp">0</li>
				</ul>
				<ul class="showEsc">
					<li class="esc">累计治愈</li>
					<li id="cure">0</li>
					<li id="addCure">0</li>
				</ul>
				<ul class="showEsc">
					<li class="esc">累计死亡</li>
					<li id="dead">0</li>
					<li id="addDead">0</li>
				</ul>
				<p style="clear:both"></p>
			</div>
			
			<div class="showMapButtonSet">
				<button class="showMapButton selected" id="nationalwideIp">全国当前确诊情况
				</button><button class="showMapButton" id="nationalwideSumIp">全国累计确诊情况</button>
			</div>
			<div style="height: 600px;  margin: 0">
				<div id="map" style="height: 800px;width: 800px"></div>
			</div>

			<div class="escMesage" style="width:775px">
				<button class="trandChartButton" style="background-color:red">全国疫情新增趋势
				</button><button class="trandChartButton">全国累计确诊疑似
				</button><button class="trandChartButton">全国累计治愈死亡
				</button><button class="trandChartButton">治愈与死亡率</button>
			</div>
			
			<div id="trendChart" style="width:775px;height:700px">
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        let myChart = echarts.init(document.getElementById('trendChart'));

        let mapDom = document.getElementById('map');
		let mapChart = echarts.init(mapDom);
		let nowConfirmData = [];
		let confirmedData = [];
		let mapOptions = {};



        function update_china_data(data) {
			$('#ip').text(data.nowConfirm)
			$('#addIp').text(data.newNowConfirm)
			$('#sumIp').text(data.confirmed)
			$('#addSumIp').text(data.newConfirmed);
			$('#sp').text(data.unconfirmed);
			$('#addSp').text(data.newUnconfirmed);
			$('#cure').text(data.cured);
			$('#addCure').text(data.newCured);
			$('#dead').text(data.died);
			$('#addDead').text(data.newDied);
		}
		
		function update_china_map(data) {
			confirmedData = [];
			nowConfirmData = [];
        	for(let i=0; i<data.length; i++){
        		nowConfirmData.push({'name': data[i].name, 'value': data[i].nowConfirm})
        		confirmedData.push({'name': data[i].name, 'value': data[i].confirmed})
			}
			mapOptions = {
				tooltip : {
					trigger: 'item'
				},
				visualMap: {
					type: 'piecewise',
					min: 0,
					max: 300,
					left: 'left',
					bottom: '20%',        // 文本，默认为数值文本
					calculable : true,
					pieces: [
						{value: 0, color: '#fff'},
						{min: 1, max: 9, color: 'rgb(255,170,133)'},
						{min: 10, max: 99, color: 'rgb(255,123,105)'},
						{min: 100, max: 999, color: 'rgb(204,41,41)'},
						{min: 1000, max: 9999, color: 'rgb(140,13,13)'},
						{min: 10000, color: 'rgb(102,2,8)'}
					],
					orient: 'horizontal',
				},
				regions: [
					{
						name: "南海诸岛",
						value: 0,
						itemStyle: {
							normal: {
								opacity: 0,
								label: {
									show: false
								}
							}
						}
					}
				],
				series :
					{
						name: '感染人数',
						type: 'map',
						mapType: 'china',
						roam: false,
						center: [110.97, 29.71],
						showLegendSymbol: false,
						label: {
							normal: {
								show: true
							},
							emphasis: {
								show: true
							}
						},

						data: nowConfirmData,
						colorMappingBy: 'value'
					}
			};
			mapChart.setOption(mapOptions, true);
		}
		
		function update_china_trend(data) {

		}
		function update_all_data(){
			$.get('/api/index', function (data, status) {
				if (status !== 'success'){
					alert('获取数据失败')
				} else {
					data = JSON.parse(data)
					update_china_data(data.china_data)
					update_china_map(data.province_data)
					update_china_trend(data.china_trend_data)
				}
			})
		}


		$(document).ready(function(){
			update_all_data();
			$('#nationalwideIp').click(function () {
				$('#nationalwideIp').addClass('selected')
				$('#nationalwideSumIp').removeClass('selected')
				mapOptions.series.data = nowConfirmData;
				mapChart.setOption(mapOptions, true);
			})
			$('#nationalwideSumIp').click(function () {
				$('#nationalwideIp').removeClass('selected')
				$('#nationalwideSumIp').addClass('selected')
				mapOptions.series.data = confirmedData;
				mapChart.setOption(mapOptions, true);
			})

		})

        // 指定图表的配置项和数据
        let option = {
            title: {},
            tooltip: {
				trigger: 'axis',
				axisPointer: {
					type: 'cross'
				}
			},
            legend: {},
            xAxis: {
                data: ["1-26","1-27","1-28","1-29","1-30","1-31","2-1","2-2","2-3","2-4","2-5","2-6","2-7","2-8","2-9"]
            },
            yAxis: [{
				type: 'value',
				name:'单位：例',
			}],
            series: [{
				name: '新增确诊',
                type: 'line',
				smooth: 'true',
                data: [5, 20, 36, 10, 10, 20, 20, 36, 10, 10, 20, 20, 36, 10, 10]
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    </script>
</body>
</html>
